---
description: 创建详细的任务执行计划,将功能分解为 2-5 分钟的小任务
---

# Plan - 任务规划工作流

## 🎯 目标

将复杂功能分解为可管理的小任务(2-5分钟),详细规划实现步骤和验证方法。

## 📋 工作流步骤

### 1. 确认设计方案

在创建计划前,应该已经完成:

- [ ] 需求澄清 (通过 `/brainstorm`)
- [ ] 设计方案批准
- [ ] 技术选型确定

### 2. 分析功能复杂度

评估功能的复杂度,确定分解粒度:

**简单功能** (< 30 分钟):

- 直接分解为 5-10 个小任务

**中等功能** (30-120 分钟):

- 先分解为 3-5 个子功能
- 每个子功能再分解为小任务

**复杂功能** (> 120 分钟):

- 分解为多个独立功能
- 每个功能单独规划

### 3. 创建任务计划文档

在 `docs/plans/` 目录下创建计划文档:

````markdown
# 功能计划: [功能名称]

## 📋 基本信息

- **功能名称**: [名称]
- **设计文档**: [链接到设计文档]
- **预计总时间**: [X 分钟]
- **优先级**: 高/中/低
- **负责人**: [AI/开发者]
- **创建时间**: 2026-01-18

## 🎯 功能目标

[简要描述要实现的功能]

## ✅ 前置条件

- [ ] 条件 1
- [ ] 条件 2

## 📝 任务列表

### 阶段 1: 准备工作

#### 任务 1.1: [任务名称]

- **预计时间**: 2 分钟
- **类型**: 环境配置/依赖安装/文件创建
- **文件**: `path/to/file`
- **操作**: 创建/修改/删除
- **命令/代码**:
  ```bash
  # 具体命令或代码
  ```
````

- **验证步骤**:
  - [ ] 验证点 1
  - [ ] 验证点 2
- **依赖**: 无
- **风险**: 无/低/中/高

#### 任务 1.2: [任务名称]

...

### 阶段 2: 核心实现 (TDD)

#### 任务 2.1: 编写测试 (RED)

- **预计时间**: 3 分钟
- **类型**: 测试
- **文件**: `path/to/test.spec.ts`
- **操作**: 创建
- **代码**:
  ```typescript
  // 测试代码
  ```
- **验证步骤**:
  - [ ] 测试文件创建成功
  - [ ] 运行测试失败 (RED) ✅
- **依赖**: 任务 1.x
- **风险**: 低

#### 任务 2.2: 实现功能 (GREEN)

- **预计时间**: 5 分钟
- **类型**: 实现
- **文件**: `path/to/implementation.ts`
- **操作**: 创建/修改
- **代码**:
  ```typescript
  // 实现代码
  ```
- **验证步骤**:
  - [ ] 测试通过 (GREEN) ✅
  - [ ] 编译无错误
- **依赖**: 任务 2.1
- **风险**: 中

#### 任务 2.3: 重构优化 (REFACTOR)

- **预计时间**: 3 分钟
- **类型**: 重构
- **文件**: `path/to/implementation.ts`
- **操作**: 修改
- **内容**: 提取函数、优化命名、改进结构
- **验证步骤**:
  - [ ] 测试仍然通过 ✅
  - [ ] 代码更清晰
- **依赖**: 任务 2.2
- **风险**: 低

### 阶段 3: 集成和测试

#### 任务 3.1: 集成测试

...

### 阶段 4: 文档和清理

#### 任务 4.1: 更新文档

...

## 🎯 验收标准

- [ ] 所有单元测试通过
- [ ] 集成测试通过
- [ ] 代码符合规范
- [ ] 文档已更新
- [ ] 功能符合需求

## 📊 时间估算

- 阶段 1: 10 分钟
- 阶段 2: 20 分钟
- 阶段 3: 15 分钟
- 阶段 4: 5 分钟
- **总计**: 50 分钟

## ⚠️ 风险和缓解措施

- **风险 1**: [描述]
  - **缓解**: [措施]
- **风险 2**: [描述]
  - **缓解**: [措施]

## 📝 执行记录

- [ ] 任务 1.1 - [完成时间]
- [ ] 任务 1.2 - [完成时间]
      ...

## 🔄 变更记录

- 2026-01-18: 创建初始计划
- 2026-01-19: 调整任务 2.3

````

### 4. 审查计划

在开始执行前,审查计划:

**检查清单**:
- [ ] 任务粒度合适 (2-5 分钟)
- [ ] 任务间依赖清晰
- [ ] 每个任务有验证步骤
- [ ] 遵循 TDD 流程
- [ ] 时间估算合理
- [ ] 风险已识别

### 5. 执行计划

按顺序执行任务:

```bash
# 1. 创建任务分支(如果使用 worktree)
/worktree feature/task-name

# 2. 逐个执行任务
# 执行任务 1.1
# 验证任务 1.1
# 执行任务 1.2
# ...

# 3. 记录进度
# 在计划文档中标记完成的任务
````

### 6. 跟踪进度

实时更新计划文档:

- ✅ 标记完成的任务
- 📝 记录实际耗时
- ⚠️ 记录遇到的问题
- 🔄 调整后续任务(如需要)

### 7. 完成验收

所有任务完成后:

- [ ] 运行所有测试
- [ ] 检查验收标准
- [ ] 更新文档
- [ ] 代码审查
- [ ] 合并代码

## 💡 实战示例: 邮件通知功能计划

让我为"邮件通知"功能创建一个完整的计划示例:

```bash
# 创建计划文档
docs/plans/email-notification-plan.md
```

详见 `.agent/superpowers/task-planning.md` 中的完整示例。

## 📊 任务分解技巧

### 技巧 1: 按层次分解

```
功能: 用户管理
├── 后端 API
│   ├── 创建用户
│   ├── 查询用户
│   ├── 更新用户
│   └── 删除用户
└── 前端页面
    ├── 用户列表
    ├── 用户详情
    └── 用户编辑
```

### 技巧 2: 按 TDD 循环分解

```
每个功能点:
1. 编写测试 (RED)
2. 实现功能 (GREEN)
3. 重构优化 (REFACTOR)
```

### 技巧 3: 按依赖关系排序

```
1. 基础设施 (数据库、配置)
2. 核心服务 (业务逻辑)
3. API 接口
4. 前端集成
5. 测试和文档
```

### 技巧 4: 识别并行任务

```
可以并行:
- 前端和后端独立功能
- 不同模块的开发
- 文档编写和代码实现

必须串行:
- 有依赖关系的任务
- TDD 的 RED-GREEN-REFACTOR
```

## 🎯 计划模板库

在 `.agent/superpowers/templates/` 创建常用模板:

### 新功能开发模板

```markdown
# 功能计划: [功能名称]

## 阶段 1: 准备工作

- 安装依赖
- 创建文件结构
- 配置环境

## 阶段 2: 后端开发 (TDD)

- 编写测试
- 实现 API
- 重构优化

## 阶段 3: 前端开发 (TDD)

- 编写测试
- 实现 UI
- 集成 API

## 阶段 4: 集成测试

- E2E 测试
- 性能测试

## 阶段 5: 文档和部署

- 更新文档
- 部署验证
```

### Bug 修复模板

```markdown
# Bug 修复计划: [Bug 描述]

## 阶段 1: 问题复现

- 创建复现测试
- 确认问题根因

## 阶段 2: 修复实现

- 编写修复代码
- 验证测试通过

## 阶段 3: 回归测试

- 运行相关测试
- 确认无副作用
```

## 🔗 与其他工作流集成

### 完整开发流程

```bash
# 1. 需求澄清
/brainstorm

# 2. 创建计划
/plan

# 3. 创建隔离环境
/worktree feature/new-feature

# 4. 执行开发
/dev

# 5. 检查完整度
/check

# 6. 合并代码
git merge feature/new-feature
```

## 📚 参考资源

- [任务规划技能](../.agent/superpowers/task-planning.md)
- [TDD 工作流](../.agent/superpowers/tdd-workflow.md)

## ⚠️ 注意事项

1. **不要过度规划**: 计划是指导,不是束缚
2. **保持灵活**: 根据实际情况调整计划
3. **及时更新**: 记录实际进度和问题
4. **经验总结**: 完成后总结经验教训
