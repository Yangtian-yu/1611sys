# ğŸš€ å€¼ç­ç³»ç»Ÿç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ—¥å¿—

**éƒ¨ç½²æ—¥æœŸ**ï¼š2026å¹´1æœˆ22æ—¥
**éƒ¨ç½²äººå‘˜**ï¼šYangtianyu
**æœåŠ¡å™¨ IP**ï¼š47.95.43.38
**é¡¹ç›®ä»“åº“**ï¼šhttps://github.com/Yangtian-yu/1611sys

---

## ğŸ“‹ ç›®å½•

1. [è´­ä¹°é˜¿é‡Œäº‘ ECS æœåŠ¡å™¨](#1-è´­ä¹°é˜¿é‡Œäº‘-ecs-æœåŠ¡å™¨)
2. [æœåŠ¡å™¨åŸºç¡€é…ç½®](#2-æœåŠ¡å™¨åŸºç¡€é…ç½®)
3. [å®‰è£… Docker ç¯å¢ƒ](#3-å®‰è£…-docker-ç¯å¢ƒ)
4. [é…ç½®å®‰å…¨ç»„å’Œé˜²ç«å¢™](#4-é…ç½®å®‰å…¨ç»„å’Œé˜²ç«å¢™)
5. [å‡†å¤‡é¡¹ç›®ä»£ç ](#5-å‡†å¤‡é¡¹ç›®ä»£ç )
6. [éƒ¨ç½²é¡¹ç›®](#6-éƒ¨ç½²é¡¹ç›®)
7. [é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ](#7-é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ)
8. [æœ€ç»ˆé…ç½®æ€»ç»“](#8-æœ€ç»ˆé…ç½®æ€»ç»“)

---

## 1. è´­ä¹°é˜¿é‡Œäº‘ ECS æœåŠ¡å™¨

### 1.1 æœåŠ¡å™¨é…ç½®

| é…ç½®é¡¹ | é€‰æ‹© | è¯´æ˜ |
|--------|------|------|
| **å®ä¾‹è§„æ ¼** | 2æ ¸2GB (ecs.e-c1m1.large) | ç»æµå‹ï¼Œ99å…ƒ/å¹´ |
| **æ“ä½œç³»ç»Ÿ** | Ubuntu 24.04 LTS 64ä½ | ç¨³å®šä¸”æ–‡æ¡£ä¸°å¯Œ |
| **ç³»ç»Ÿç›˜** | ESSD Entry 40GB | å¤Ÿç”¨ |
| **å¸¦å®½** | æŒ‰å›ºå®šå¸¦å®½ 3Mbps | å°å‹é¡¹ç›®å¤Ÿç”¨ |
| **åœ°åŸŸ** | ååŒ—2ï¼ˆåŒ—äº¬ï¼‰ | å›½å†…è®¿é—®é€Ÿåº¦å¿« |
| **ä»˜è´¹æ¨¡å¼** | åŒ…å¹´åŒ…æœˆ 1å¹´ | 99å…ƒ/å¹´ç‰¹æƒ  |

### 1.2 è´­ä¹°æ­¥éª¤

1. è®¿é—®é˜¿é‡Œäº‘æ§åˆ¶å°ï¼šhttps://ecs.console.aliyun.com/
2. åˆ›å»ºå®ä¾‹ï¼Œé€‰æ‹©ä¸Šè¿°é…ç½®
3. è®¾ç½® root å¯†ç ï¼ˆå·²è®¾ç½®å¼ºå¯†ç ï¼‰
4. å®Œæˆæ”¯ä»˜

### 1.3 è·å–æœåŠ¡å™¨ä¿¡æ¯

- **å…¬ç½‘ IP**ï¼š47.95.43.38
- **å®ä¾‹ ID**ï¼ši-2ze0s0qqu8dhwy5sgssgZ
- **åœ°åŸŸ**ï¼šååŒ—2ï¼ˆåŒ—äº¬ï¼‰

---

## 2. æœåŠ¡å™¨åŸºç¡€é…ç½®

### 2.1 è¿æ¥åˆ°æœåŠ¡å™¨

**å·¥å…·**ï¼šFinalShellï¼ˆMac å¯è§†åŒ– SSH å·¥å…·ï¼‰

**è¿æ¥ä¿¡æ¯**ï¼š
- ä¸»æœºï¼š47.95.43.38
- ç«¯å£ï¼š22
- ç”¨æˆ·åï¼šroot
- å¯†ç ï¼šï¼ˆå·²è®¾ç½®ï¼‰

### 2.2 æ›´æ–°ç³»ç»Ÿ

```bash
# æ›´æ–°åŒ…åˆ—è¡¨
apt update

# å‡çº§å·²å®‰è£…çš„åŒ…
apt upgrade -y
```

**æ‰§è¡Œæ—¶é—´**ï¼šçº¦ 2-3 åˆ†é’Ÿ

---

## 3. å®‰è£… Docker ç¯å¢ƒ

### 3.1 ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæºå®‰è£…

ç”±äºå›½å†…è®¿é—® Docker å®˜æ–¹æºè¾ƒæ…¢ï¼Œä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæºï¼š

```bash
# ä½¿ç”¨å®˜æ–¹ä¾¿æ·è„šæœ¬ï¼ˆé˜¿é‡Œäº‘é•œåƒï¼‰
curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun
```

**æ‰§è¡Œæ—¶é—´**ï¼šçº¦ 3-5 åˆ†é’Ÿ

### 3.2 éªŒè¯å®‰è£…

```bash
docker --version
# è¾“å‡ºï¼šDocker version 29.1.5

docker compose version
# è¾“å‡ºï¼šDocker Compose version v2.x.x
```

### 3.3 é…ç½® Docker é•œåƒåŠ é€Ÿ

åˆ›å»º Docker é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨å›½å†…é•œåƒæºï¼š

```bash
# åˆ›å»ºé…ç½®ç›®å½•
mkdir -p /etc/docker

# é…ç½®é•œåƒåŠ é€Ÿ
cat > /etc/docker/daemon.json <<'EOF'
{
  "registry-mirrors": [
    "https://docker.m.daocloud.io",
    "https://dockerproxy.com",
    "https://mirror.baidubce.com",
    "https://docker.nju.edu.cn"
  ]
}
EOF

# é‡å¯ Docker æœåŠ¡
systemctl daemon-reload
systemctl restart docker

# éªŒè¯é…ç½®
docker info | grep -A 5 "Registry Mirrors"
```

**åŸå› **ï¼šå›½å†…è®¿é—® Docker Hub å¾ˆæ…¢ï¼Œé…ç½®é•œåƒæºå¯å¤§å¹…æå‡ä¸‹è½½é€Ÿåº¦

---

## 4. é…ç½®å®‰å…¨ç»„å’Œé˜²ç«å¢™

### 4.1 é˜¿é‡Œäº‘å®‰å…¨ç»„é…ç½®

åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°é…ç½®å®‰å…¨ç»„è§„åˆ™ï¼š

**è·¯å¾„**ï¼šäº‘æœåŠ¡å™¨ ECS â†’ å®‰å…¨ç»„ â†’ é…ç½®è§„åˆ™ â†’ å…¥æ–¹å‘

æ·»åŠ ä»¥ä¸‹è§„åˆ™ï¼š

| ç«¯å£èŒƒå›´ | åè®® | æˆæƒå¯¹è±¡ | è¯´æ˜ |
|---------|------|----------|------|
| 22/22 | TCP | 0.0.0.0/0 | SSH ç™»å½• |
| 80/80 | TCP | 0.0.0.0/0 | HTTP è®¿é—® |
| 443/443 | TCP | 0.0.0.0/0 | HTTPS è®¿é—®ï¼ˆé¢„ç•™ï¼‰ |

### 4.2 æœåŠ¡å™¨é˜²ç«å¢™é…ç½®

Ubuntu ä½¿ç”¨ UFW é˜²ç«å¢™ï¼š

```bash
# å¯ç”¨ UFW
ufw enable

# å…è®¸ SSHï¼ˆé‡è¦ï¼ï¼‰
ufw allow 22/tcp

# å…è®¸ HTTP å’Œ HTTPS
ufw allow 80/tcp
ufw allow 443/tcp

# æŸ¥çœ‹çŠ¶æ€
ufw status
```

---

## 5. å‡†å¤‡é¡¹ç›®ä»£ç 

### 5.1 Git ä»“åº“ç®¡ç†

#### é—®é¢˜ï¼šæ•æ„Ÿæ–‡ä»¶æ³„éœ²

é¡¹ç›®ä¸­çš„ `.env` æ–‡ä»¶åŒ…å«æ•°æ®åº“å¯†ç ã€JWT å¯†é’¥ã€QQ é‚®ç®±æˆæƒç ç­‰æ•æ„Ÿä¿¡æ¯ï¼Œå·²ç»è¢«æäº¤åˆ° Gitã€‚

#### è§£å†³æ–¹æ¡ˆ

**åœ¨æœ¬åœ°æ‰§è¡Œ**ï¼š

```bash
cd /Users/yangtianyu/Desktop/å­¦ä¹ æ–‡ä»¶å¤¹/1611sys

# 1. åˆ›å»º .gitignore æ–‡ä»¶
cat > .gitignore << 'EOF'
# ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰
.env
.env.local
.env.production
.env.*.local

# ä¾èµ–ç›®å½•
node_modules/
backend/node_modules/
frontend/node_modules/

# æ„å»ºè¾“å‡º
dist/
build/
backend/dist/
frontend/dist/

# æ—¥å¿—æ–‡ä»¶
*.log

# æ“ä½œç³»ç»Ÿæ–‡ä»¶
.DS_Store

# IDE é…ç½®
.vscode/
.idea/

# æ•°æ®åº“æ–‡ä»¶
*.sql
EOF

# 2. ä» Git ä¸­åˆ é™¤æ•æ„Ÿæ–‡ä»¶ï¼ˆä¿ç•™æœ¬åœ°ï¼‰
git rm --cached .env .env.local .env.production

# 3. æäº¤æ›´æ”¹
git add .gitignore
git commit -m "Remove sensitive env files from git and add .gitignore"

# 4. æ¨é€åˆ° GitHub
git push origin main
```

**é‡è¦**ï¼šè™½ç„¶ä» Git ä¸­åˆ é™¤äº†ï¼Œä½†å†å²è®°å½•ä¸­ä»å­˜åœ¨ï¼Œéœ€è¦ï¼š
- âœ… ä¿®æ”¹ QQ é‚®ç®±æˆæƒç ï¼ˆå·²å®Œæˆï¼‰
  - æ—§æˆæƒç ï¼š`lybcqqdecxcobjii`ï¼ˆå·²åˆ é™¤ï¼‰
  - æ–°æˆæƒç ï¼š`vcmhzyagfkmbbjcb`
- âœ… ä¿®æ”¹æ•°æ®åº“å¯†ç ä¸ºå¼ºå¯†ç 

### 5.2 å…¬å¼€ä»“åº“

å°†ç§æœ‰ä»“åº“æ”¹ä¸ºå…¬å¼€ï¼š
- **åŸå› **ï¼šæ–¹ä¾¿éƒ¨ç½²ï¼Œä¸éœ€è¦ Token æˆ– SSH å¯†é’¥
- **è·¯å¾„**ï¼šGitHub ä»“åº“ â†’ Settings â†’ Danger Zone â†’ Change visibility â†’ Make public

### 5.3 å…‹éš†ä»£ç åˆ°æœåŠ¡å™¨

```bash
cd /root
git clone https://github.com/Yangtian-yu/1611sys.git
cd 1611sys
```

---

## 6. éƒ¨ç½²é¡¹ç›®

### 6.1 åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶

åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cat > .env << 'EOF'
# ç”Ÿäº§ç¯å¢ƒé…ç½®
NODE_ENV=production

# æ•°æ®åº“é…ç½®
POSTGRES_USER=postgres
POSTGRES_PASSWORD=ProdDB@2026!Strong#Pass
POSTGRES_DB=duty_system

# æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
DATABASE_URL=postgresql://postgres:ProdDB@2026!Strong#Pass@postgres:5432/duty_system

# JWT å¯†é’¥
JWT_SECRET=1611sys-production-jwt-secret-key-2026-very-strong-abc123xyz

# åç«¯ç«¯å£
PORT=3000

# é‚®ä»¶æœåŠ¡é…ç½®
MAIL_USER=535173883@qq.com
MAIL_PASS=vcmhzyagfkmbbjcb

# é¦–æ¬¡éƒ¨ç½²
DB_SEED=true
EOF
```

**æ³¨æ„**ï¼š
- ä½¿ç”¨å¼ºå¯†ç 
- é‚®ç®±æˆæƒç ä½¿ç”¨æ–°ç”Ÿæˆçš„
- `DB_SEED=true` ç”¨äºé¦–æ¬¡éƒ¨ç½²ç”Ÿæˆæµ‹è¯•æ•°æ®

### 6.2 ä¿®æ”¹å‰ç«¯ API åœ°å€

```bash
nano frontend/Dockerfile
```

ä¿®æ”¹ç¬¬ 20 è¡Œå·¦å³çš„ç¯å¢ƒå˜é‡ï¼š

```dockerfile
ENV VITE_API_BASE_URL=http://47.95.43.38/api
```

### 6.3 ä¿®æ”¹ Dockerfile ä½¿ç”¨å›½å†…é•œåƒæº

#### é—®é¢˜ï¼šnpm ä¸‹è½½ä¾èµ–è¶…æ—¶

æ„å»ºè¿‡ç¨‹ä¸­å¡åœ¨ `RUN npm install -g pnpm`ï¼Œå›½å†…è®¿é—® npm å®˜æ–¹æºå¾ˆæ…¢ã€‚

#### è§£å†³æ–¹æ¡ˆ

ä¿®æ”¹ `backend/Dockerfile` å’Œ `frontend/Dockerfile`ï¼Œæ·»åŠ å›½å†…é•œåƒæºé…ç½®ã€‚

**åç«¯ Dockerfile**ï¼š

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM node:20-slim as builder

# é…ç½®å›½å†…é•œåƒæº
RUN npm config set registry https://registry.npmmirror.com && \
    npm install -g pnpm && \
    pnpm config set registry https://registry.npmmirror.com

WORKDIR /app

# å¤åˆ¶ä¾èµ–é…ç½®æ–‡ä»¶
COPY package.json pnpm-lock.yaml ./
COPY prisma ./prisma/

# å®‰è£…ä¾èµ–
RUN pnpm install --frozen-lockfile

# å¤åˆ¶æºä»£ç 
COPY . .

# ç”Ÿæˆ Prisma Client
RUN pnpm prisma generate

# æ„å»ºé¡¹ç›®
RUN pnpm build

# ç”Ÿäº§é˜¶æ®µ
FROM node:20-slim

# å®‰è£…è¿è¡Œæ—¶ä¾èµ–
RUN apt-get update && apt-get install -y \
    openssl \
    ca-certificates \
    netcat-openbsd \
    && rm -rf /var/lib/apt/lists/*

# é…ç½®å›½å†…é•œåƒæº
RUN npm config set registry https://registry.npmmirror.com && \
    npm install -g pnpm && \
    pnpm config set registry https://registry.npmmirror.com

WORKDIR /app

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶æ–‡ä»¶
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/prisma ./prisma
COPY --from=builder /app/package.json ./

EXPOSE 3000

CMD ["sh", "-c", "pnpm prisma migrate deploy && node dist/main"]
```

**å‰ç«¯ Dockerfile**ï¼š

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM node:20-alpine as builder

# é…ç½®å›½å†…é•œåƒæº
RUN npm config set registry https://registry.npmmirror.com && \
    npm install -g pnpm && \
    pnpm config set registry https://registry.npmmirror.com

WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package.json pnpm-lock.yaml ./

# å®‰è£…ä¾èµ–
RUN pnpm install --frozen-lockfile

# å¤åˆ¶æºä»£ç 
COPY . .

# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆç”Ÿäº§ç¯å¢ƒ API åœ°å€ï¼‰
ENV VITE_API_BASE_URL=http://47.95.43.38/api

# æ„å»º
RUN pnpm build

# ç”Ÿäº§é˜¶æ®µ
FROM nginx:alpine

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/dist /usr/share/nginx/html

# å¤åˆ¶ Nginx é…ç½®
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

### 6.4 å¯åŠ¨é¡¹ç›®

```bash
docker compose up -d --build
```

**å‚æ•°è¯´æ˜**ï¼š
- `up`ï¼šå¯åŠ¨æœåŠ¡
- `-d`ï¼šåå°è¿è¡Œ
- `--build`ï¼šé‡æ–°æ„å»ºé•œåƒ

**é¢„è®¡æ—¶é—´**ï¼š
- ç¬¬ä¸€æ¬¡æ„å»ºï¼š5-8 åˆ†é’Ÿï¼ˆé…ç½®é•œåƒæºåï¼‰
- åç»­æ›´æ–°ï¼š2-3 åˆ†é’Ÿ

### 6.5 æŸ¥çœ‹æ„å»ºæ—¥å¿—

```bash
docker compose logs -f
```

æŒ‰ `Ctrl + C` é€€å‡ºæ—¥å¿—æŸ¥çœ‹ï¼ˆä¸å½±å“æœåŠ¡è¿è¡Œï¼‰

### 6.6 æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
docker compose ps
```

**æˆåŠŸæ ‡å¿—**ï¼š3 ä¸ªæœåŠ¡éƒ½æ˜¯ `Up` çŠ¶æ€ï¼š
```
NAME                   STATUS
duty-system-db         Up
duty-system-backend    Up
duty-system-frontend   Up
```

---

## 7. é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šç¯å¢ƒå˜é‡æœªåŠ è½½

**ç°è±¡**ï¼š
```
WARN[0000] The "POSTGRES_PASSWORD" variable is not set. Defaulting to a blank string.
```

**åŸå› **ï¼š`.env` æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œå¤šä¸ªå˜é‡å†™åœ¨åŒä¸€è¡Œã€‚

**é”™è¯¯æ ¼å¼**ï¼š
```bash
POSTGRES_USER=postgres POSTGRES_PASSWORD=xxx POSTGRES_DB=duty_system
```

**æ­£ç¡®æ ¼å¼**ï¼š
```bash
POSTGRES_USER=postgres
POSTGRES_PASSWORD=xxx
POSTGRES_DB=duty_system
```

**è§£å†³æ–¹æ¡ˆ**ï¼šé‡æ–°åˆ›å»º `.env` æ–‡ä»¶ï¼Œç¡®ä¿æ¯ä¸ªå˜é‡å•ç‹¬ä¸€è¡Œã€‚

---

### é—®é¢˜ 2ï¼šDocker Hub é•œåƒä¸‹è½½è¶…æ—¶

**ç°è±¡**ï¼š
```
failed to resolve reference "docker.io/library/postgres:16-alpine": dial tcp 198.44.185.131:443: i/o timeout
```

**åŸå› **ï¼šå›½å†…è®¿é—® Docker Hub è¢«é™åˆ¶æˆ–å¾ˆæ…¢ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šé…ç½®å›½å†… Docker é•œåƒåŠ é€Ÿæºã€‚

```bash
cat > /etc/docker/daemon.json <<'EOF'
{
  "registry-mirrors": [
    "https://docker.m.daocloud.io",
    "https://dockerproxy.com",
    "https://mirror.baidubce.com",
    "https://docker.nju.edu.cn"
  ]
}
EOF

systemctl daemon-reload
systemctl restart docker
```

---

### é—®é¢˜ 3ï¼šnpm å®‰è£…ä¾èµ–è¶…æ—¶

**ç°è±¡**ï¼šæ„å»ºå¡åœ¨ `RUN npm install -g pnpm`ï¼Œè¶…è¿‡ 28 åˆ†é’Ÿæ— å“åº”ã€‚

**åŸå› **ï¼šå›½å†…è®¿é—® npm å®˜æ–¹æºå¾ˆæ…¢æˆ–è¢«å¢™ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ Dockerfile ä¸­é…ç½®æ·˜å® npm é•œåƒæºã€‚

```dockerfile
RUN npm config set registry https://registry.npmmirror.com && \
    npm install -g pnpm && \
    pnpm config set registry https://registry.npmmirror.com
```

---

### é—®é¢˜ 4ï¼šåç«¯ Dockerfile æ„å»ºå¤±è´¥

**ç°è±¡**ï¼š
```
process "/bin/sh -c apt-get install -y libssl3" did not complete successfully: exit code: 100
```

**åŸå› **ï¼š`libssl3` åŒ…åœ¨æŸäº› Debian ç‰ˆæœ¬ä¸­ä¸å­˜åœ¨ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šå°† `libssl3` æ”¹ä¸º `ca-certificates`ã€‚

```dockerfile
RUN apt-get update && apt-get install -y \
    openssl \
    ca-certificates \      # æ”¹ä¸º ca-certificates
    netcat-openbsd \
    && rm -rf /var/lib/apt/lists/*
```

---

### é—®é¢˜ 5ï¼šæ•æ„Ÿä¿¡æ¯æ³„éœ²åˆ° Git

**ç°è±¡**ï¼š`.env` æ–‡ä»¶åŒ…å«å¯†ç ã€å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯å·²æäº¤åˆ° GitHubã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. åˆ›å»º `.gitignore` å¿½ç•¥ `.env` æ–‡ä»¶
2. ä½¿ç”¨ `git rm --cached` ä» Git ä¸­åˆ é™¤ï¼ˆä¿ç•™æœ¬åœ°æ–‡ä»¶ï¼‰
3. ä¿®æ”¹å·²æ³„éœ²çš„å¯†ç å’Œå¯†é’¥
4. æäº¤å¹¶æ¨é€æ›´æ”¹

---

### é—®é¢˜ 6ï¼šæ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²è§£æé”™è¯¯

**ç°è±¡**ï¼š
```
Can't reach database server at `2026!Strong:5432`
```

**åŸå› **ï¼šæ•°æ®åº“å¯†ç  `ProdDB@2026!Strong#Pass` åŒ…å« `@` ç¬¦å·ï¼Œå¯¼è‡´ URL è§£æé”™è¯¯ã€‚

åœ¨è¿æ¥å­—ç¬¦ä¸² `postgresql://postgres:ProdDB@2026!Strong#Pass@postgres:5432/duty_system` ä¸­ï¼Œå¯†ç ä¸­çš„ `@` è¢«è¯¯è®¤ä¸ºæ˜¯ä¸»æœºååˆ†éš”ç¬¦ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šä¿®æ”¹å¯†ç ï¼Œé¿å…ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ `@`ã€`:` ã€`/`ã€‚

```bash
# ä¿®æ”¹ä¸ºä¸å« @ ç¬¦å·çš„å¯†ç 
POSTGRES_PASSWORD=ProdDB_2026_Strong_Pass_9527
DATABASE_URL=postgresql://postgres:ProdDB_2026_Strong_Pass_9527@postgres:5432/duty_system
```

---

### é—®é¢˜ 7ï¼šæ•°æ®åº“å¯†ç è®¤è¯å¤±è´¥

**ç°è±¡**ï¼š
```
Error: P1000: Authentication failed against database server at `postgres`,
the provided database credentials for `postgres` are not valid.
```

**åŸå› **ï¼šæ•°æ®åº“å®¹å™¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ç”¨æ—§å¯†ç åˆå§‹åŒ–ï¼Œå¯†ç å·²å­˜å‚¨åœ¨ Docker volume ä¸­ã€‚ä¿®æ”¹ `.env` æ–‡ä»¶åï¼Œæ•°æ®åº“å®¹å™¨å†…çš„å¯†ç æ²¡æœ‰æ›´æ–°ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šåˆ é™¤æ•°æ®åº“å·ï¼Œé‡æ–°åˆå§‹åŒ–ã€‚

```bash
docker compose down
docker volume rm 1611sys_postgres_data
docker compose up -d
```

---

### é—®é¢˜ 8ï¼šåç«¯å¯åŠ¨å¤±è´¥ - æ‰¾ä¸åˆ° main æ¨¡å—

**ç°è±¡**ï¼š
```
Error: Cannot find module '/app/dist/main'
```

**åŸå› **ï¼šåç«¯ Docker é•œåƒæ„å»ºè¿‡ç¨‹ä¸­ï¼Œ`dist` ç›®å½•æ²¡æœ‰æ­£ç¡®ç”Ÿæˆæˆ–å¤åˆ¶ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ„å»ºé˜¶æ®µæ˜¯å¦æ­£ç¡®æ‰§è¡Œ `pnpm build`
2. æ£€æŸ¥ç”Ÿäº§é˜¶æ®µæ˜¯å¦æ­£ç¡®å¤åˆ¶ `COPY --from=builder /app/dist ./dist`
3. é‡æ–°æ„å»ºé•œåƒï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰

```bash
docker compose down
docker rmi 1611sys-backend
docker compose build --no-cache backend
docker compose up -d
```

---

### é—®é¢˜ 9ï¼šæ— æ³•è®¿é—® Debian è½¯ä»¶æº

**ç°è±¡**ï¼š
```
E: Failed to fetch http://deb.debian.org/debian/pool/main/...
E: Unable to connect to deb.debian.org:80
```

**åŸå› **ï¼šå›½å†…è®¿é—® Debian å®˜æ–¹æºå¾ˆæ…¢æˆ–è¢«å¢™ï¼Œå¯¼è‡´ `apt-get install` è¶…æ—¶ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ Dockerfile ä¸­é…ç½®å›½å†… Debian é•œåƒæºï¼ˆé˜¿é‡Œäº‘ï¼‰ã€‚

```dockerfile
# åœ¨ apt-get ä¹‹å‰æ·»åŠ 
RUN sed -i 's/deb.debian.org/mirrors.aliyun.com/g' /etc/apt/sources.list.d/debian.sources

# ç„¶åæ‰§è¡Œ apt-get
RUN apt-get update && apt-get install -y ...
```

---

### é—®é¢˜ 10ï¼šæ•°æ®åº“è¡¨æœªåˆå§‹åŒ–

**ç°è±¡**ï¼š
```
The table `public.users` does not exist in the current database
```

**åŸå› **ï¼šPrisma è¿ç§»æœªæ‰§è¡Œï¼Œæ•°æ®åº“ä¸­æ²¡æœ‰åˆ›å»ºè¡¨ç»“æ„ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `db push` åˆ›å»ºè¡¨ç»“æ„ã€‚

```bash
docker compose exec backend pnpm prisma db push
```

**æ³¨æ„**ï¼š
- å¼€å‘ç¯å¢ƒç”¨ `prisma migrate dev`
- ç”Ÿäº§ç¯å¢ƒé¦–æ¬¡éƒ¨ç½²ç”¨ `prisma db push`
- åç»­æ›´æ–°ç”¨ `prisma migrate deploy`

---

### é—®é¢˜ 11ï¼šJWT è®¤è¯åç”¨æˆ· ID undefined é”™è¯¯

**ç°è±¡**ï¼š
ç™»å½•æˆåŠŸï¼Œä½†ä¿®æ”¹å‘˜å·¥ã€è°ƒæ•´å‘˜å·¥é¡ºåºã€ä¿®æ”¹å¯†ç ç­‰æ“ä½œå…¨éƒ¨æŠ¥ 500 é”™è¯¯ã€‚
```
Invalid `prisma.user.findUnique()` invocation:
{
  where: {
    id: undefined,  // âŒ ç”¨æˆ· ID ä¸º undefined
```

**åŸå› **ï¼šä»£ç ä¸­å­˜åœ¨ 3 ä¸ª bugï¼ˆæœ¬åœ°æœªå®Œæ•´æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ï¼Œåªæµ‹è¯•äº†ç™»å½•ï¼‰ï¼š
1. **auth.controller.ts**ï¼šä½¿ç”¨äº† `req.user.userId` ä½†åº”è¯¥æ˜¯ `req.user.id`
2. **user.controller.ts**ï¼šä½¿ç”¨ `ParseIntPipe` å°† UUID å­—ç¬¦ä¸²è½¬æˆæ•´æ•°ï¼Œç±»å‹ä¸åŒ¹é…
3. **user.service.ts**ï¼šå‚æ•°ç±»å‹æ˜¯ `number` ä½†æ•°æ®åº“ ID æ˜¯ UUID å­—ç¬¦ä¸²

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. ä¿®å¤ `backend/src/modules/auth/auth.controller.ts`ï¼š
```typescript
// é”™è¯¯
return this.authService.changePassword(req.user.userId, changePasswordDto);

// æ­£ç¡®
return this.authService.changePassword(req.user.id, changePasswordDto);
```

2. ä¿®å¤ `backend/src/modules/user/user.controller.ts`ï¼š
```typescript
// é”™è¯¯ - ä½¿ç”¨ ParseIntPipe
@Put(":id")
update(@Param("id", ParseIntPipe) id: number, @Body() updateUserDto: UpdateUserDto)

// æ­£ç¡® - ç§»é™¤ ParseIntPipeï¼Œä½¿ç”¨ string
@Put(":id")
update(@Param("id") id: string, @Body() updateUserDto: UpdateUserDto)
```

3. ä¿®å¤ `backend/src/modules/user/user.service.ts`ï¼š
```typescript
// é”™è¯¯ - å‚æ•°æ˜¯ numberï¼Œè¿˜è¦ String(id) è½¬æ¢
async update(id: number, updateUserDto: UpdateUserDto) {
  const user = await this.prisma.user.findUnique({
    where: { id: String(id) },
  });
}

// æ­£ç¡® - å‚æ•°ç›´æ¥æ˜¯ string
async update(id: string, updateUserDto: UpdateUserDto) {
  const user = await this.prisma.user.findUnique({
    where: { id },
  });
}
```

4. ä¿®å¤ `backend/src/modules/user/dto/reorder-users.dto.ts`ï¼š
```typescript
// é”™è¯¯
userIds: number[];

// æ­£ç¡®
userIds: string[];
```

**éƒ¨ç½²æ­¥éª¤**ï¼š
```bash
cd ~/1611sys
git pull origin main
docker compose down
docker compose build backend  # åªä¿®æ”¹äº†ä»£ç ï¼Œç”¨ç¼“å­˜æ„å»ºå³å¯
docker compose up -d
```

**ç»éªŒæ•™è®­**ï¼š
- æœ¬åœ°å¼€å‘æ—¶å¿…é¡»æµ‹è¯•æ‰€æœ‰ CRUD æ“ä½œï¼Œä¸èƒ½åªæµ‹è¯•ç™»å½•
- TypeScript ç±»å‹è¦å’Œæ•°æ®åº“ schema ä¿æŒä¸€è‡´ï¼ˆUUID æ˜¯ string ä¸æ˜¯ numberï¼‰
- ç”Ÿäº§éƒ¨ç½²å‰åº”è¯¥æœ‰å®Œæ•´çš„åŠŸèƒ½æµ‹è¯•æ¸…å•

---

## 8. æœ€ç»ˆé…ç½®æ€»ç»“

### 8.1 æœåŠ¡å™¨é…ç½®

| é¡¹ç›® | é…ç½® |
|------|------|
| **æœåŠ¡å™¨** | é˜¿é‡Œäº‘ ECS |
| **è§„æ ¼** | 2æ ¸2GB |
| **æ“ä½œç³»ç»Ÿ** | Ubuntu 24.04 LTS |
| **å…¬ç½‘ IP** | 47.95.43.38 |
| **è´¹ç”¨** | 99å…ƒ/å¹´ï¼ˆç»­è´¹åŒä»·ï¼‰ |

### 8.2 è½¯ä»¶ç‰ˆæœ¬

| è½¯ä»¶ | ç‰ˆæœ¬ |
|------|------|
| **Docker** | 29.1.5 |
| **Docker Compose** | v2.x.x |
| **Node.js** | 20 (å®¹å™¨å†…) |
| **PostgreSQL** | 16 (å®¹å™¨å†…) |
| **Nginx** | alpine (å®¹å™¨å†…) |

### 8.3 é¡¹ç›®ç»“æ„

```
/root/1611sys/
â”œâ”€â”€ backend/              # åç«¯ä»£ç ï¼ˆNestJSï¼‰
â”œâ”€â”€ frontend/             # å‰ç«¯ä»£ç ï¼ˆVue 3ï¼‰
â”œâ”€â”€ docker-compose.yml    # Docker Compose é…ç½®
â”œâ”€â”€ .env                  # ç”Ÿäº§ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤åˆ° Gitï¼‰
â””â”€â”€ .gitignore           # Git å¿½ç•¥æ–‡ä»¶é…ç½®
```

### 8.4 æœåŠ¡ç«¯å£æ˜ å°„

| æœåŠ¡ | å®¹å™¨ç«¯å£ | ä¸»æœºç«¯å£ | è¯´æ˜ |
|------|----------|----------|------|
| **Frontend** | 80 | 80 | Nginx å‰ç«¯æœåŠ¡ |
| **Backend** | 3000 | 3000 | NestJS åç«¯ API |
| **Database** | 5432 | 5432 | PostgreSQL æ•°æ®åº“ |

### 8.5 è®¿é—®åœ°å€

- **å‰ç«¯è®¿é—®**ï¼šhttp://47.95.43.38
- **åç«¯ API**ï¼šhttp://47.95.43.38/api

### 8.6 é»˜è®¤ç™»å½•è´¦å·

ï¼ˆå¦‚æœå¯ç”¨äº†ç§å­æ•°æ® `DB_SEED=true`ï¼‰

- **ç”¨æˆ·å**ï¼šadmin
- **å¯†ç **ï¼šadmin123

---

## 9. æ—¥å¸¸ç»´æŠ¤å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
cd /root/1611sys
docker compose ps
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker compose logs -f backend
docker compose logs -f frontend
docker compose logs -f postgres
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker compose restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker compose restart backend
```

### æ›´æ–°é¡¹ç›®

```bash
cd /root/1611sys

# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker compose up -d --build
```

### å¤‡ä»½æ•°æ®åº“

```bash
# å¯¼å‡ºæ•°æ®åº“
docker exec duty-system-db pg_dump -U postgres duty_system > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
docker exec -i duty-system-db psql -U postgres duty_system < backup_20260122.sql
```

### æ¸…ç† Docker èµ„æº

```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒå’Œå®¹å™¨
docker system prune -a

# æ¸…ç†æœªä½¿ç”¨çš„å·
docker volume prune
```

---

## 10. åç»­ä¼˜åŒ–å»ºè®®

### 10.1 é…ç½®åŸŸåå’Œ HTTPS

å½“å‰ä½¿ç”¨ IP è®¿é—®ï¼Œå»ºè®®ï¼š
1. è´­ä¹°åŸŸå
2. é…ç½® DNS è§£æåˆ°æœåŠ¡å™¨ IP
3. ä½¿ç”¨ Let's Encrypt å…è´¹ SSL è¯ä¹¦
4. é…ç½® Nginx HTTPS

### 10.2 é…ç½® GitHub Actions è‡ªåŠ¨éƒ¨ç½²

å®ç°æ¨é€ä»£ç è‡ªåŠ¨éƒ¨ç½²ï¼š
1. é…ç½® GitHub Actions workflow
2. åœ¨ GitHub Actions æ„å»º Docker é•œåƒ
3. æ¨é€åˆ°é•œåƒä»“åº“ï¼ˆé˜¿é‡Œäº‘ï¼‰
4. æœåŠ¡å™¨è‡ªåŠ¨æ‹‰å–å¹¶æ›´æ–°

**ä¼˜åŠ¿**ï¼š
- æ„å»ºåœ¨ GitHub æœåŠ¡å™¨è¿›è¡Œï¼ˆ2æ ¸7GBï¼‰
- æœåŠ¡å™¨åªéœ€ä¸‹è½½é•œåƒï¼ˆ30ç§’å®Œæˆéƒ¨ç½²ï¼‰
- ä¸å ç”¨æœåŠ¡å™¨èµ„æº

### 10.3 ç›‘æ§å’Œå‘Šè­¦

å»ºè®®æ·»åŠ ï¼š
- æœåŠ¡å™¨èµ„æºç›‘æ§ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰
- åº”ç”¨æ—¥å¿—ç›‘æ§
- é”™è¯¯å‘Šè­¦ï¼ˆé‚®ä»¶/å¾®ä¿¡ï¼‰

### 10.4 æ•°æ®åº“å®šæœŸå¤‡ä»½

å»ºè®®é…ç½®ï¼š
- æ¯å¤©è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“
- å¤‡ä»½æ–‡ä»¶ä¿ç•™ 7 å¤©
- å®šæœŸæµ‹è¯•æ¢å¤æµç¨‹

---

## 11. éƒ¨ç½²æ€»ç»“

### 11.1 éƒ¨ç½²æ—¶é—´çº¿

| é˜¶æ®µ | è€—æ—¶ | è¯´æ˜ |
|------|------|------|
| **è´­ä¹°æœåŠ¡å™¨** | 5 åˆ†é’Ÿ | é€‰æ‹©é…ç½®å¹¶æ”¯ä»˜ |
| **åŸºç¡€é…ç½®** | 10 åˆ†é’Ÿ | è¿æ¥ã€æ›´æ–°ç³»ç»Ÿ |
| **å®‰è£… Docker** | 5 åˆ†é’Ÿ | ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒ |
| **é…ç½®å®‰å…¨ç»„** | 5 åˆ†é’Ÿ | å¼€æ”¾ç«¯å£ |
| **å‡†å¤‡ä»£ç ** | 15 åˆ†é’Ÿ | Git å¤„ç†ã€å…‹éš† |
| **é¦–æ¬¡éƒ¨ç½²** | 8 åˆ†é’Ÿ | æ„å»ºå¹¶å¯åŠ¨ï¼ˆå·²ä¼˜åŒ–ï¼‰ |
| **æ€»è®¡** | **çº¦ 50 åˆ†é’Ÿ** | é¦–æ¬¡å®Œæ•´éƒ¨ç½² |

### 11.2 å…³é”®è¦ç‚¹

âœ… **æˆåŠŸè¦ç´ **ï¼š
1. é€‰æ‹©å›½å†…é•œåƒæºï¼ˆDockerã€npmï¼‰
2. æ­£ç¡®é…ç½®ç¯å¢ƒå˜é‡ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰
3. é…ç½®å®‰å…¨ç»„å¼€æ”¾ç«¯å£
4. ä½¿ç”¨ Docker Compose ç®€åŒ–éƒ¨ç½²
5. æ•æ„Ÿä¿¡æ¯ä¸æäº¤åˆ° Git

âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼š
1. å®šæœŸå¤‡ä»½æ•°æ®åº“
2. ç›‘æ§æœåŠ¡å™¨èµ„æºä½¿ç”¨
3. åŠæ—¶æ›´æ–°ç³»ç»Ÿå’Œä¾èµ–
4. å…³æ³¨å®‰å…¨æ¼æ´å…¬å‘Š

### 11.3 æŠ€æœ¯æ ˆ

**å‰ç«¯**ï¼š
- Vue 3 + Vite
- Element Plus
- Pinia
- TypeScript

**åç«¯**ï¼š
- NestJS
- Prisma ORM
- PostgreSQL
- JWT è®¤è¯

**éƒ¨ç½²**ï¼š
- Docker + Docker Compose
- Nginx
- é˜¿é‡Œäº‘ ECS

---

## 12. å‚è€ƒèµ„æº

- **Docker å®˜æ–¹æ–‡æ¡£**ï¼šhttps://docs.docker.com/
- **é˜¿é‡Œäº‘ ECS æ–‡æ¡£**ï¼šhttps://help.aliyun.com/product/25365.html
- **GitHub Actions æ–‡æ¡£**ï¼šhttps://docs.github.com/en/actions
- **Let's Encrypt**ï¼šhttps://letsencrypt.org/
- **æ·˜å® npm é•œåƒ**ï¼šhttps://npmmirror.com/

---

## é™„å½•ï¼šå®Œæ•´é…ç½®æ–‡ä»¶

### backend/Dockerfileï¼ˆæœ€ç»ˆç‰ˆæœ¬ï¼‰

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM node:20-slim as builder

# é…ç½® Debian å›½å†…é•œåƒæº
RUN sed -i 's/deb.debian.org/mirrors.aliyun.com/g' /etc/apt/sources.list.d/debian.sources

# é…ç½® npm å›½å†…é•œåƒæº
RUN npm config set registry https://registry.npmmirror.com && \
    npm install -g pnpm && \
    pnpm config set registry https://registry.npmmirror.com

WORKDIR /app

COPY package.json pnpm-lock.yaml ./
COPY prisma ./prisma/

RUN pnpm install --frozen-lockfile

COPY . .

RUN pnpm prisma generate

RUN pnpm build

# ç”Ÿäº§é˜¶æ®µ
FROM node:20-slim

# é…ç½® Debian å›½å†…é•œåƒæº
RUN sed -i 's/deb.debian.org/mirrors.aliyun.com/g' /etc/apt/sources.list.d/debian.sources

# å®‰è£…è¿è¡Œæ—¶ä¾èµ–
RUN apt-get update && apt-get install -y \
    openssl \
    ca-certificates \
    netcat-openbsd \
    && rm -rf /var/lib/apt/lists/*

# é…ç½® npm å›½å†…é•œåƒæº
RUN npm config set registry https://registry.npmmirror.com && \
    npm install -g pnpm && \
    pnpm config set registry https://registry.npmmirror.com

WORKDIR /app

COPY --from=builder /app/dist ./dist
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/prisma ./prisma
COPY --from=builder /app/package.json ./

EXPOSE 3000

CMD ["sh", "-c", "pnpm prisma migrate deploy && node dist/main"]
```

### docker-compose.yml

ï¼ˆå½“å‰é¡¹ç›®å·²æœ‰ï¼Œæ— éœ€ä¿®æ”¹ï¼‰

### .envï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

```bash
NODE_ENV=production
POSTGRES_USER=postgres
POSTGRES_PASSWORD=ProdDB_2026_Strong_Pass_9527
POSTGRES_DB=duty_system
DATABASE_URL=postgresql://postgres:ProdDB_2026_Strong_Pass_9527@postgres:5432/duty_system
JWT_SECRET=1611sys-production-jwt-secret-key-2026-very-strong-abc123xyz
PORT=3000
MAIL_USER=535173883@qq.com
MAIL_PASS=vcmhzyagfkmbbjcb
DB_SEED=true
```

**æ³¨æ„äº‹é¡¹**ï¼š
- å¯†ç ä¸è¦åŒ…å« `@`ã€`:`ã€`/` ç­‰ç‰¹æ®Šç¬¦å·ï¼ˆä¼šå¯¼è‡´ URL è§£æé”™è¯¯ï¼‰
- æ¯ä¸ªå˜é‡å¿…é¡»å•ç‹¬ä¸€è¡Œ
- é‚®ç®±æˆæƒç å·²æ›´æ–°ä¸ºæ–°ç”Ÿæˆçš„

### .gitignore

```bash
# ç¯å¢ƒå˜é‡æ–‡ä»¶
.env
.env.local
.env.production
.env.*.local

# ä¾èµ–ç›®å½•
node_modules/
backend/node_modules/
frontend/node_modules/

# æ„å»ºè¾“å‡º
dist/
build/
backend/dist/
frontend/dist/

# æ—¥å¿—æ–‡ä»¶
*.log

# æ“ä½œç³»ç»Ÿæ–‡ä»¶
.DS_Store

# IDE é…ç½®
.vscode/
.idea/

# æ•°æ®åº“æ–‡ä»¶
*.sql
```

---

**éƒ¨ç½²å¼€å§‹æ—¶é—´**ï¼š2026å¹´1æœˆ22æ—¥ 15:30
**éƒ¨ç½²å®Œæˆæ—¶é—´**ï¼š2026å¹´1æœˆ23æ—¥ 00:45
**æ–‡æ¡£æ•´ç†äºº**ï¼šClaude Code Assistant
**çŠ¶æ€**ï¼šâœ… éƒ¨ç½²æˆåŠŸï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸

---

## æ›´æ–°æ—¥å¿—

- **2026-01-22 15:30**ï¼šå¼€å§‹è´­ä¹°é˜¿é‡Œäº‘ ECS æœåŠ¡å™¨
- **2026-01-22 15:45**ï¼šå®ŒæˆæœåŠ¡å™¨è´­ä¹°ï¼ˆ99å…ƒ/å¹´ï¼ŒUbuntu 24.04ï¼‰
- **2026-01-22 16:00**ï¼šè¿æ¥æœåŠ¡å™¨æˆåŠŸï¼ˆFinalShellï¼‰
- **2026-01-22 16:15**ï¼šå®Œæˆç³»ç»Ÿæ›´æ–°å’Œ Docker å®‰è£…
- **2026-01-22 16:30**ï¼šé…ç½® Docker é•œåƒåŠ é€Ÿï¼ˆé˜¿é‡Œäº‘ï¼‰
- **2026-01-22 16:45**ï¼šé…ç½®å®‰å…¨ç»„å¼€æ”¾ç«¯å£ï¼ˆ22ã€80ã€443ï¼‰
- **2026-01-22 17:00**ï¼šå¤„ç† Git æ•æ„Ÿæ–‡ä»¶æ³„éœ²é—®é¢˜
  - åˆ›å»º `.gitignore`
  - ä» Git ä¸­åˆ é™¤ `.env` æ–‡ä»¶
  - æ›´æ–° QQ é‚®ç®±æˆæƒç 
- **2026-01-22 17:15**ï¼šå°† GitHub ä»“åº“æ”¹ä¸ºå…¬å¼€
- **2026-01-22 17:30**ï¼šå…‹éš†ä»£ç åˆ°æœåŠ¡å™¨
- **2026-01-22 17:45**ï¼šé…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
  - é‡åˆ°ç¯å¢ƒå˜é‡æ ¼å¼é—®é¢˜ï¼ˆå¤šä¸ªå˜é‡åœ¨åŒä¸€è¡Œï¼‰
  - ä¿®å¤ä¸ºæ¯è¡Œä¸€ä¸ªå˜é‡
- **2026-01-22 18:00**ï¼šé¦–æ¬¡æ„å»ºå¯åŠ¨
  - é‡åˆ° npm é•œåƒæºé—®é¢˜ï¼ˆå¡ä½ 28 åˆ†é’Ÿï¼‰
  - é…ç½®æ·˜å® npm é•œåƒæº
- **2026-01-22 18:30**ï¼šè§£å†³ Dockerfile ä¾èµ–é—®é¢˜
  - ä¿®æ”¹ `libssl3` ä¸º `ca-certificates`
  - æ·»åŠ  npm é•œåƒæºé…ç½®
- **2026-01-22 18:45**ï¼šæ„å»ºå®Œæˆï¼Œå¯åŠ¨æœåŠ¡
  - é‡åˆ°æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²è§£æé”™è¯¯ï¼ˆå¯†ç åŒ…å« @ ç¬¦å·ï¼‰
  - ä¿®æ”¹å¯†ç ä¸ºä¸å«ç‰¹æ®Šç¬¦å·
- **2026-01-22 19:00**ï¼šè§£å†³æ•°æ®åº“è®¤è¯é—®é¢˜
  - åˆ é™¤æ—§çš„æ•°æ®åº“ volume
  - é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
- **2026-01-22 19:10**ï¼šé‡åˆ°åç«¯æ¨¡å—ç¼ºå¤±é—®é¢˜
  - åç«¯é•œåƒç¼ºå°‘ `dist` ç›®å½•
  - é‡æ–°æ„å»ºé•œåƒ
- **2026-01-22 19:20**ï¼šè§£å†³ Debian æºæ— æ³•è®¿é—®é—®é¢˜
  - é…ç½®é˜¿é‡Œäº‘ Debian é•œåƒæº
  - é‡æ–°æ„å»ºæˆåŠŸ
- **2026-01-22 19:45**ï¼šåç«¯å¯åŠ¨æˆåŠŸï¼Œå‰ç«¯è®¿é—®æ­£å¸¸
  - ç™»å½•åŠŸèƒ½æµ‹è¯•é€šè¿‡
  - å€¼ç­è¡¨æŸ¥è¯¢æ­£å¸¸
- **2026-01-22 20:00**ï¼šå‘ç° CRUD æ“ä½œæŠ¥é”™é—®é¢˜
  - ä¿®æ”¹å‘˜å·¥ã€è°ƒæ•´é¡ºåºã€ä¿®æ”¹å¯†ç å…¨éƒ¨æŠ¥ 500 é”™è¯¯
  - åç«¯æ—¥å¿—æ˜¾ç¤º `id: undefined`
- **2026-01-23 00:30**ï¼šå®šä½å¹¶ä¿®å¤ JWT è®¤è¯å’Œç±»å‹é”™è¯¯
  - ä¿®å¤ `req.user.userId` â†’ `req.user.id`
  - ç§»é™¤ `ParseIntPipe`ï¼Œç»Ÿä¸€ä½¿ç”¨ string ç±»å‹
  - ä¿®å¤æ‰€æœ‰ service æ–¹æ³•çš„å‚æ•°ç±»å‹
  - æ¨é€ä»£ç å¹¶é‡æ–°éƒ¨ç½²
- **2026-01-23 00:45**ï¼šæ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡ âœ…
  - ç™»å½• âœ…
  - æŸ¥çœ‹å‘˜å·¥åˆ—è¡¨ âœ…
  - æ–°å¢å‘˜å·¥ âœ…
  - ä¿®æ”¹å‘˜å·¥ä¿¡æ¯ âœ…
  - è°ƒæ•´å‘˜å·¥é¡ºåº âœ…
  - ä¿®æ”¹å¯†ç  âœ…
  - å€¼ç­è¡¨æŸ¥è¯¢ âœ…

---

## éƒ¨ç½²è¿‡ç¨‹æ€»ç»“

### æˆåŠŸç»éªŒ

âœ… **é•œåƒæºé…ç½®è‡³å…³é‡è¦**ï¼š
- Docker Hub é•œåƒåŠ é€Ÿ
- npm/pnpm æ·˜å®é•œåƒ
- Debian apt é˜¿é‡Œäº‘é•œåƒ

âœ… **ç¯å¢ƒå˜é‡æ³¨æ„äº‹é¡¹**ï¼š
- æ¯ä¸ªå˜é‡å•ç‹¬ä¸€è¡Œ
- å¯†ç é¿å…ç‰¹æ®Šå­—ç¬¦ï¼ˆ@ã€:ã€/ï¼‰
- ä¿®æ”¹å¯†ç åéœ€è¦åˆ é™¤æ•°æ®åº“ volume

âœ… **é—®é¢˜æ’æŸ¥æµç¨‹**ï¼š
1. æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼š`docker compose ps`
2. æŸ¥çœ‹æ—¥å¿—ï¼š`docker compose logs [service]`
3. æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼š`cat .env`
4. é‡æ–°æ„å»ºï¼š`docker compose build --no-cache`

âœ… **æµ‹è¯•æ¸…å•**ï¼š
- ç™»å½•/ç™»å‡º
- æŸ¥çœ‹å‘˜å·¥åˆ—è¡¨
- æ–°å¢å‘˜å·¥
- ä¿®æ”¹å‘˜å·¥ä¿¡æ¯
- åˆ é™¤å‘˜å·¥
- è°ƒæ•´å‘˜å·¥é¡ºåº
- ä¿®æ”¹å¯†ç 
- æŸ¥çœ‹å€¼ç­è¡¨
- ç”Ÿæˆå€¼ç­è¡¨
- å‘é€å€¼ç­é€šçŸ¥

### è¸©è¿‡çš„å‘

âŒ **å¯†ç ç‰¹æ®Šå­—ç¬¦**ï¼š
- `@` ç¬¦å·å¯¼è‡´ URL è§£æé”™è¯¯
- æ”¹ç”¨ä¸‹åˆ’çº¿å’Œæ•°å­—ç»„åˆ

âŒ **npm é•œåƒæº**ï¼š
- å›½å¤–æºè¶…æ—¶ 28 åˆ†é’Ÿ
- é…ç½®å›½å†…æºå 2-3 åˆ†é’Ÿæå®š

âŒ **æ•°æ®åº“ volume æŒä¹…åŒ–**ï¼š
- ä¿®æ”¹å¯†ç åéœ€è¦åˆ é™¤æ—§ volume
- å¦åˆ™å¯†ç ä¸åŒ¹é…

âŒ **Debian è½¯ä»¶æº**ï¼š
- å®˜æ–¹æºæ— æ³•è®¿é—®
- éœ€è¦é…ç½®å›½å†…é•œåƒ

âŒ **TypeScript ç±»å‹ä¸æ•°æ®åº“ä¸ä¸€è‡´**ï¼š
- UUID åœ¨æ•°æ®åº“ä¸­æ˜¯å­—ç¬¦ä¸²ï¼Œä¸æ˜¯æ•°å­—
- NestJS çš„ `ParseIntPipe` ä¼šå°† UUID è½¬æˆæ•´æ•°å¯¼è‡´é”™è¯¯
- æœ¬åœ°æµ‹è¯•ä¸å®Œæ•´ï¼Œåªæµ‹äº†ç™»å½•æ²¡æµ‹ CRUD

âŒ **Docker æ„å»ºç¼“å­˜ä½¿ç”¨**ï¼š
- åªä¿®æ”¹ä»£ç æ—¶ä¸éœ€è¦ `--no-cache`ï¼Œä¼šæµªè´¹å¤§é‡æ—¶é—´
- ä¿®æ”¹ Dockerfileã€package.jsonã€.env æ—¶æ‰éœ€è¦ `--no-cache`
- åˆç†ä½¿ç”¨ç¼“å­˜å¯ä»¥å°†æ„å»ºæ—¶é—´ä» 2-3 åˆ†é’Ÿé™åˆ° 30-60 ç§’

### æ—¶é—´æ¶ˆè€—åˆ†æ

| é˜¶æ®µ | è®¡åˆ’æ—¶é—´ | å®é™…æ—¶é—´ | ä¸»è¦è€—æ—¶åŸå›  |
|------|---------|---------|-------------|
| è´­ä¹°é…ç½®æœåŠ¡å™¨ | 10åˆ†é’Ÿ | 15åˆ†é’Ÿ | å­¦ä¹ é˜¿é‡Œäº‘ç•Œé¢ |
| å®‰è£… Docker | 5åˆ†é’Ÿ | 10åˆ†é’Ÿ | é…ç½®é•œåƒåŠ é€Ÿ |
| ä»£ç å‡†å¤‡ | 15åˆ†é’Ÿ | 45åˆ†é’Ÿ | Git æ•æ„Ÿæ–‡ä»¶å¤„ç† |
| é¦–æ¬¡æ„å»º | 10åˆ†é’Ÿ | 90åˆ†é’Ÿ | npm æºé—®é¢˜å¡ä½ 28 åˆ†é’Ÿï¼ŒDockerfile è°ƒæ•´ |
| è°ƒè¯•ç¯å¢ƒé—®é¢˜ | 10åˆ†é’Ÿ | 90åˆ†é’Ÿ | å¯†ç ã€volumeã€Dockerfileã€æ•°æ®åº“åˆå§‹åŒ– |
| è°ƒè¯•ä¸šåŠ¡ bug | - | 90åˆ†é’Ÿ | JWT è®¤è¯ã€ç±»å‹é”™è¯¯ï¼Œæœ¬åœ°æµ‹è¯•ä¸å®Œæ•´ |
| **æ€»è®¡** | **50åˆ†é’Ÿ** | **çº¦5.5å°æ—¶** | é•œåƒæºã€é…ç½®ã€ä»£ç  bug ç­‰å¤šä¸ªé—®é¢˜ |

---

**å·²å®Œæˆä»»åŠ¡**ï¼š
1. âœ… éªŒè¯åç«¯æœåŠ¡çŠ¶æ€å˜ä¸º `Up`
2. âœ… æµ‹è¯•ç½‘ç«™ç™»å½•åŠŸèƒ½
3. âœ… éªŒè¯æ•°æ®åº“ç§å­æ•°æ®
4. âœ… ä¿®å¤ä¸šåŠ¡ bugï¼ˆJWT è®¤è¯ã€ç±»å‹é”™è¯¯ï¼‰
5. âœ… æµ‹è¯•æ‰€æœ‰ CRUD åŠŸèƒ½
6. âœ… æ›´æ–°éƒ¨ç½²æ–‡æ¡£

**ä¸‹ä¸€æ­¥**ï¼ˆå¯é€‰ï¼‰ï¼š
1. ğŸš€ é…ç½® GitHub Actions è‡ªåŠ¨éƒ¨ç½²
2. ğŸ”’ é…ç½®åŸŸåå’Œ HTTPS
3. ğŸ“Š é…ç½®ç›‘æ§å’Œæ—¥å¿—æ”¶é›†
4. ğŸ”„ è®¾ç½®å®šæ—¶å¤‡ä»½
