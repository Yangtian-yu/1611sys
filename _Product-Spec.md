# 1611 值日系统 - 产品规格文档

**版本**：v1.0  
**创建日期**：2026-01-16  
**最后更新**：2026-01-16

---

## 项目概述

### 项目名称

1611 值日系统

### 目标用户

- **主要用户**：办公室管理员（1 人）
- **次要用户**：办公室员工（约 15 人）
- **使用场景**：办公室值日安排管理，每周五需要 2 人打扫卫生

### 核心价值主张

解决办公室值日安排混乱、员工容易忘记值日的问题，通过自动化排班和邮件提醒，确保值日工作有序进行。

### 核心痛点

1. 现有 Excel 表格管理方式，员工经常忘记查看
2. 人员变动时需要手动重新排班，容易出错
3. 缺乏自动提醒机制，依赖人工通知

---

## 功能需求

### P0 功能（必须有 - 第一版实现）

#### 1. 用户认证系统

- **管理员登录**
  - 系统部署时预设一个超级管理员账号
  - 使用用户名 + 密码登录
  - 密码需加密存储（bcrypt）
- **员工登录**

  - 使用管理员创建的账号登录
  - 用户名 + 密码认证
  - 无需注册功能

- **密码管理**
  - 用户可修改自己的密码
  - 管理员可重置任何用户的密码

#### 2. 员工管理（仅管理员）

- **创建员工账号**
  - 输入：用户名、初始密码、邮箱（QQ 邮箱）
  - 自动添加到值日轮换列表末尾
- **编辑员工信息**
  - 修改用户名、邮箱
  - 重置密码
- **调整员工顺序**
  - 拖拽排序功能
  - 调整后自动重新计算未来排班
- **删除员工**
  - 员工离职时删除账号
  - 自动从值日列表中移除

#### 3. 值日排班系统

- **自动排班逻辑**
  - 每周一早上自动生成本周值日安排
  - 轮流制：按员工列表顺序，每次取 2 人
  - 示例（15 人）：
    - 第 1 周：A + B
    - 第 2 周：C + D
    - ...
    - 第 8 周：O + A（循环）
- **特殊情况处理**

  - 支持一周安排超过 2 人（如 4 人大扫除）
  - 管理员手动调整后，所有参与者一起移到下一轮
  - 示例：本周 A+B+C+D 打扫，下周从 E+F 开始

- **查看排班**
  - 所有用户可查看当前周值日人员
  - 仅显示本周，不显示未来周（因人员可能变动）

#### 4. 邮件通知系统

- **发送时机**
  - 每周五下午 4:00 自动发送
- **通知对象**
  - 发送给所有员工（非仅值日人员）
- **邮件内容**
  - 可由管理员编辑的模板
  - 默认模板：

    ```
    【1611值日系统】本周值日通知

    本周值日人员：张三、李四

    值日时间：本周五下午
    请准时完成值日工作，谢谢配合！
    ```
- **技术实现**
  - 使用 SMTP 发送邮件
  - 支持 QQ 邮箱等常见邮箱服务

#### 5. 管理员功能面板

- **编辑邮件通知文案**
  - 富文本编辑器或纯文本
  - 支持变量：`{值日人员}`, `{日期}`
- **手动调整本周值日**
  - 临时修改本周值日人员
  - 可增加人数（2 人变 4 人）
  - 调整后自动更新下一轮排班

---

### P1 功能（重要 - 第二版实现）

#### 1. 历史记录查看

- 查看过去的值日记录
- 按周、按月筛选
- 导出为 Excel

#### 2. 数据统计

- 每人值日次数统计
- 值日完成率

#### 3. 手动触发邮件

- 管理员可手动发送邮件通知
- 用于测试或补发

---

### P2 功能（锦上添花 - 未来考虑）

#### 1. 值日打卡

- 值日人员完成后打卡确认
- 记录完成时间

#### 2. 暗色模式

- 支持浅色/深色主题切换

#### 3. 移动端适配

- 响应式设计，支持手机访问

---

## 用户故事

### 管理员

1. 作为管理员，我想要创建员工账号，以便新员工可以登录系统查看值日安排
2. 作为管理员，我想要调整员工顺序，以便在人员变动时快速更新排班
3. 作为管理员，我想要手动调整本周值日人员，以便应对临时情况（如员工请假）
4. 作为管理员，我想要编辑邮件通知文案，以便根据实际情况调整通知内容
5. 作为管理员，我想要重置员工密码，以便帮助忘记密码的员工

### 普通员工

1. 作为员工，我想要登录系统查看本周值日人员，以便知道谁负责打扫
2. 作为员工，我想要修改自己的密码，以便保护账号安全
3. 作为员工，我想要每周五收到邮件提醒，以便不会忘记值日安排

---

## 技术约束

### 技术栈

- **前端**：Vue 3 + Vite + TypeScript + Tailwind CSS + Element Plus
- **后端**：Nest.js + Prisma + PostgreSQL
- **部署**：云服务器（已购买）
- **邮件服务**：Nodemailer + SMTP

### 性能要求

- 页面加载时间 < 2 秒
- 支持 15 人同时在线
- 邮件发送成功率 > 95%

### 安全要求

- 密码使用 bcrypt 加密存储
- 使用 JWT 进行身份验证
- 防止 SQL 注入（使用 Prisma ORM）
- HTTPS 加密传输

### 兼容性要求

- 仅支持桌面端访问
- 浏览器：Chrome 90+, Edge 90+, Firefox 88+

---

## 数据库设计

### 核心表结构

#### users（用户表）

```sql
- id: UUID (主键)
- username: VARCHAR(50) (唯一)
- password: VARCHAR(255) (bcrypt 加密)
- email: VARCHAR(100)
- role: ENUM('admin', 'employee')
- order_index: INTEGER (值日顺序)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

#### duty_schedules（值日排班表）

```sql
- id: UUID (主键)
- week_start_date: DATE (周一日期)
- duty_users: JSON (值日人员 ID 数组)
- is_manual: BOOLEAN (是否手动调整)
- created_at: TIMESTAMP
```

#### email_templates（邮件模板表）

```sql
- id: UUID (主键)
- template_content: TEXT
- updated_at: TIMESTAMP
```

---

## 验收标准

### 功能验收

- [ ] 管理员可成功创建员工账号
- [ ] 员工可使用账号密码登录
- [ ] 系统每周一自动生成本周值日安排
- [ ] 每周五下午 4 点自动发送邮件给所有员工
- [ ] 管理员可拖拽调整员工顺序，排班自动更新
- [ ] 管理员可手动调整本周值日人员（支持 2 人变 4 人）
- [ ] 用户可修改自己的密码
- [ ] 管理员可重置任何用户的密码

### 性能验收

- [ ] 页面加载时间 < 2 秒
- [ ] 邮件发送延迟 < 10 秒

### 安全验收

- [ ] 密码在数据库中以加密形式存储
- [ ] 未登录用户无法访问系统功能
- [ ] 普通员工无法访问管理员功能

---

## 风险与备选方案

### 主要风险

#### 1. 邮件发送失败

- **风险**：QQ 邮箱 SMTP 可能被限流或拒绝
- **备选方案**：
  - 使用企业邮箱服务（如阿里云邮件推送）
  - 添加邮件发送失败重试机制
  - 在系统内显示"邮件发送失败"提示

#### 2. 排班逻辑复杂度

- **风险**：频繁的人员调整可能导致排班混乱
- **备选方案**：
  - 添加"排班预览"功能，调整前先预览
  - 记录每次调整的历史，支持回滚

#### 3. 定时任务可靠性

- **风险**：服务器重启可能导致定时任务失效
- **备选方案**：
  - 使用 cron 或系统级定时任务
  - 添加任务执行日志，便于排查

---

## 开发计划

### 第一阶段（核心功能）

- 用户认证系统
- 员工管理
- 基础排班逻辑

### 第二阶段（自动化）

- 自动排班生成
- 邮件通知系统
- 定时任务

### 第三阶段（优化）

- 手动调整排班
- 邮件模板编辑
- 密码管理

---

## 附录

### 初始管理员账号

- 用户名：admin
- 初始密码：Admin@1611（首次登录后强制修改）

### 邮件发送配置

- SMTP 服务器：smtp.qq.com
- 端口：465（SSL）或 587（TLS）
- 需要在 QQ 邮箱设置中开启 SMTP 服务并获取授权码
